{% extends "base.html" %}
{% block content %}
{% load filter_tags %}

<div class="row">
<div class="col-md-4">

<form class="form">
<button type="submit" class="btn btn-primary">UPDATE FILTERS</button>

 <input type="hidden" name="query" value="{{ query }}">
 <input type="hidden" name="idx" value="{{ idx_name }}">
</div>
</div>

<div class="row">
<div class="col-md-4">
<br/>
{% for idx, idxmap in mappings.items %}
	<div class="panel panel-info">
	<div class="panel-heading"><h3 class="panel-title">{{ idx }}</h3></div>
	<div class="panel-body">
	{% for type, values in idxmap.mappings.items %}
		<div><strong>{{ type }}</strong></div>

		{% for para, para_type in values.properties.items %}
		    {% if para_type.properties %}
		    	<div class="panel panel-default">
		        <div class="panel-body">
		        <div>{{ para }}:</div>
		    	{% for subpara, subpara_type in para_type.properties.items %}
		    			<div class="checkbox"><label>
		    			<input type="checkbox" name="{{ subpara }}" value="{{ type }}:{{ para }}:{{ subpara }}"
		    				{% if para.subpara in fields or para|add:"."|add:subpara in fields %}checked{% endif %}>{{ subpara }}</label></div>
		    	{% endfor %}
		    	</div></div>
		    {% elif "string" == para_type.type %}
		        <div class="checkbox">
		    		<label><input type="checkbox" name="{{ para }}" value="{{ type }}:{{ para }}" 
		    			{% if para in fields %}checked{% endif %}>{{ para }}</label>
		    	</div>
	        {% endif %}
		{% endfor %}
		
	{% endfor %}
	</div></div>
{% endfor %}

</form>
</div>

<div class="col-md-8">
{{ data|length }} of {{ hits_total }} hit(s) for '{{ query }}':

{% for doc in data %}
	<div class="panel panel-default">
  	<div class="panel-body">
  	<span class="badge">{{ doc|doc_type }}</span><br/>
	{% for key in doc|doc_keys %}
		{% if key != "_meta" %}
		    {{ key }}:
			{{ doc|doc_attr:key }};
		{% endif %}
	{% endfor %}
	<br/><br/>Matches: <br/>{{ doc|doc_highlight|safe }}<br/>
	<a href="{{ doc|doc_link|safe }}" target="_blank">document <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span></a>
	</div>
	</div>
{% endfor %}
</div>
</div>

{% endblock %}
